# ✅ 腾讯云 API 配置检查清单

## 📋 配置前准备

在配置之前，请确保你已经：

- [ ] 注册腾讯云账号
- [ ] 完成实名认证（需要身份证）
- [ ] 开通智能创作引擎服务
- [ ] 获取 API 密钥（SecretId 和 SecretKey）

> 如果还没有完成，请参考：[SETUP.md](./SETUP.md)

---

## 🔑 第一步：获取腾讯云 API 密钥

### 快速访问链接

1. **访问管理 - API 密钥页面**：
   ```
   https://console.cloud.tencent.com/cam/capi
   ```

2. **点击【新建密钥】**

3. **复制并保存密钥**（只显示一次！）
   ```
   SecretId: AKID_your_actual_secret_id_here
   SecretKey: ....... (32位字符串)
   ```

### 密钥格式验证

- ✅ SecretId 应该以 `AKID` 开头，长度约 36 字符
- ✅ SecretKey 长度约 32 字符
- ✅ 密钥状态为"启用"

---

## 🔧 第二步：配置 .env 文件

你的 `.env` 文件已经准备好了，现在需要填入密钥。

### 打开 .env 文件

```bash
# 使用你喜欢的编辑器打开
vim .env
# 或
code .env
# 或
nano .env
```

### 找到腾讯云配置部分（第 65-80 行）

```bash
# ----------------------------------------
# 腾讯云 API 配置 (图片风格化)
# ----------------------------------------
# 腾讯云 SecretId (访问管理 -> 访问密钥获取)
TENCENT_CLOUD_SECRET_ID=your_secret_id_here

# 腾讯云 SecretKey
TENCENT_CLOUD_SECRET_KEY=your_secret_key_here

# 腾讯云地域: ap-guangzhou | ap-beijing | ap-shanghai
TENCENT_CLOUD_REGION=ap-guangzhou

# 风格化处理超时时间(秒)
STYLE_TRANSFER_TIMEOUT=60

# 风格化最大重试次数
STYLE_TRANSFER_MAX_RETRIES=3
```

### 替换为你的密钥

将上面的 `your_secret_id_here` 和 `your_secret_key_here` 替换为你的实际密钥：

```bash
TENCENT_CLOUD_SECRET_ID=AKID_your_actual_secret_id_here_your_actual_secret_id_here
TENCENT_CLOUD_SECRET_KEY=your_actual_secret_key_32_chars
TENCENT_CLOUD_REGION=ap-guangzhou
```

### 保存文件

- Vim: 按 `ESC`，输入 `:wq`，回车
- VSCode: `Ctrl+S` (Windows/Linux) 或 `Cmd+S` (Mac)
- Nano: `Ctrl+O` 保存，`Ctrl+X` 退出

---

## ✅ 第三步：验证配置

### 3.1 检查 .env 文件

```bash
# 查看配置（不会显示完整密钥，安全）
grep "TENCENT_CLOUD" .env
```

**预期输出**：
```
TENCENT_CLOUD_SECRET_ID=AKID_your_actual_secret_id_here...
TENCENT_CLOUD_SECRET_KEY=xxxxxxxx...
TENCENT_CLOUD_REGION=ap-guangzhou
```

### 3.2 确认密钥格式

- [ ] SecretId 以 `AKID` 开头
- [ ] 密钥中没有多余的空格
- [ ] 没有引号（不需要用引号包裹）
- [ ] Region 拼写正确（ap-guangzhou、ap-beijing 或 ap-shanghai）

---

## 🖼️ 第四步：准备测试图片

### 4.1 准备一张测试图片

**要求**：
- 格式：JPG、PNG 或 WEBP
- 大小：< 10 MB（建议 2-5 MB）
- 分辨率：建议 1024x1024 左右
- 内容：人物照片（动漫风格效果最佳）

### 4.2 重命名并放到指定目录

```bash
# 进入 example 目录
cd example/tencent_cloud

# 复制你的图片并重命名
cp /path/to/your/photo.jpg test_input.jpg

# 或者直接下载一张测试图片（示例）
# curl -o test_input.jpg https://example.com/test-photo.jpg
```

### 4.3 验证图片

```bash
# 检查文件是否存在
ls -lh test_input.jpg

# 查看图片信息（可选）
file test_input.jpg
```

**预期输出**：
```
-rw-r--r--  1 user  staff   2.3M Oct 25 12:00 test_input.jpg
```

---

## 🚀 第五步：运行验证测试

### 5.1 安装依赖

```bash
# 进入后端目录
cd ../../backend

# 安装腾讯云 SDK
pip install tencentcloud-sdk-python-aiart

# 或安装全部依赖
pip install -r requirements.txt
```

### 5.2 运行测试脚本

```bash
# 返回到 example 目录
cd ../example/tencent_cloud

# 运行验证脚本
python test_api.py
```

### 5.3 查看测试结果

#### ✅ 成功的输出示例

```
============================================================
🚀 腾讯云图像风格化 API 配置验证工具
============================================================

============================================================
🔍 步骤 1: 检查环境变量配置
============================================================
✅ 找到 .env 文件: /path/to/.env
✅ 环境变量配置正确
   SecretId: AKID_your_actual_secret_id_here
   SecretKey: xxxxxxxxxx...xxxx
   Region: ap-guangzhou

============================================================
📦 步骤 2: 检查依赖包
============================================================
✅ tencentcloud-sdk-python-aiart 已安装

============================================================
🖼️  步骤 3: 检查测试图片
============================================================
✅ 找到测试图片: test_input.jpg
   文件大小: 2.34 MB

============================================================
🎨 步骤 4: 测试 API 调用
============================================================

🔧 初始化腾讯云客户端...
✅ 客户端初始化成功

🎨 开始测试图片风格化...
   输入图片: test_input.jpg
   风格类型: anime (动漫风格)
   输出图片: test_output_anime.jpg

   ⏳ 处理中，预计需要 10-30 秒...

图片已保存到: test_output_anime.jpg

============================================================
🎉 测试成功！
============================================================
✅ 请求ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
✅ 输出文件: test_output_anime.jpg

============================================================
✅ 配置验证完成！
============================================================
```

#### ❌ 常见错误和解决方案

**错误 1：找不到 .env 文件**
```
❌ 错误：找不到 .env 文件
```
**解决**：确保在项目根目录有 `.env` 文件

---

**错误 2：SecretId 未配置**
```
❌ 错误：TENCENT_CLOUD_SECRET_ID 未配置
```
**解决**：检查 `.env` 文件中是否正确填写了 SecretId

---

**错误 3：密钥不正确**
```
❌ 测试失败: [AuthFailure] authentication failed
```
**解决**：
1. 检查密钥是否复制完整
2. 确认密钥状态为"启用"
3. 等待 1-2 分钟后重试

---

**错误 4：余额不足**
```
❌ 测试失败: [ResourceUsSuspended.InsufficientBalance]
```
**解决**：
1. 检查免费额度是否用完
2. 访问费用中心充值

---

**错误 5：图片格式错误**
```
❌ 测试失败: [FailedOperation.ImageDecodeFailed]
```
**解决**：
1. 确保图片格式为 JPG、PNG 或 WEBP
2. 尝试使用更小的图片

---

## 🎨 第六步：查看生成结果

### 6.1 找到输出文件

```bash
# 在 example/tencent_cloud 目录
ls -lh test_output_anime.jpg
```

### 6.2 查看图片

- **Mac**: `open test_output_anime.jpg`
- **Linux**: `xdg-open test_output_anime.jpg`
- **Windows**: `start test_output_anime.jpg`

### 6.3 尝试更多风格

编辑 `test_api.py`，修改风格类型：

```python
# 第 138 行附近
result = client.transfer_style(
    image_path="test_input.jpg",
    style_type="cartoon_3d",  # 改为其他风格
    output_path="test_output_cartoon.jpg"
)
```

**可用风格**：
- `anime` - 日系动漫风格
- `cartoon_3d` - 3D卡通（皮克斯风格）
- `sketch` - 铅笔素描
- `watercolor` - 水彩画
- `oil_painting` - 油画

---

## 📊 配置完成确认

完成以上所有步骤后，请确认：

- [x] ✅ .env 文件已配置腾讯云密钥
- [x] ✅ 依赖包已安装
- [x] ✅ 测试图片已准备
- [x] ✅ 验证脚本运行成功
- [x] ✅ 生成的图片效果满意

---

## 🎯 下一步

配置完成后，你可以：

1. **查看完整文档**
   - [README.md](./README.md) - 完整使用指南
   - [API_STYLE.md](../../docs/API_STYLE.md) - API 设计文档

2. **开始集成到项目**
   - 实现后端 API
   - 创建前端界面
   - 参考 README.md 的"集成到项目"章节

3. **探索更多功能**
   - 批量处理多张图片
   - 调整风格强度参数
   - 集成到 Celery 异步任务

---

## 💡 提示

### 安全建议
- ⚠️ 不要将 `.env` 文件提交到 Git
- ⚠️ 定期更换 API 密钥（建议 3-6 个月）
- ⚠️ 使用子账号密钥而非主账号

### 成本控制
- 💰 免费额度：100 次/月
- 💰 超量计费：约 0.1 元/次
- 💰 建议设置费用告警

### 性能优化
- ⚡ 图片压缩至 1024x1024 可加快处理
- ⚡ 使用 Celery 异步处理避免阻塞
- ⚡ 相同图片+风格可缓存结果

---

**检查清单版本**: v1.0
**创建日期**: 2025-10-25
**适用于**: 首次配置腾讯云图像风格化 API

祝你配置顺利！🎉
