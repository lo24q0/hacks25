# âœ… è…¾è®¯äº‘ API é…ç½®æ£€æŸ¥æ¸…å•

## ğŸ“‹ é…ç½®å‰å‡†å¤‡

åœ¨é…ç½®ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»ï¼š

- [ ] æ³¨å†Œè…¾è®¯äº‘è´¦å·
- [ ] å®Œæˆå®åè®¤è¯ï¼ˆéœ€è¦èº«ä»½è¯ï¼‰
- [ ] å¼€é€šæ™ºèƒ½åˆ›ä½œå¼•æ“æœåŠ¡
- [ ] è·å– API å¯†é’¥ï¼ˆSecretId å’Œ SecretKeyï¼‰

> å¦‚æœè¿˜æ²¡æœ‰å®Œæˆï¼Œè¯·å‚è€ƒï¼š[SETUP.md](./SETUP.md)

---

## ğŸ”‘ ç¬¬ä¸€æ­¥ï¼šè·å–è…¾è®¯äº‘ API å¯†é’¥

### å¿«é€Ÿè®¿é—®é“¾æ¥

1. **è®¿é—®ç®¡ç† - API å¯†é’¥é¡µé¢**ï¼š
   ```
   https://console.cloud.tencent.com/cam/capi
   ```

2. **ç‚¹å‡»ã€æ–°å»ºå¯†é’¥ã€‘**

3. **å¤åˆ¶å¹¶ä¿å­˜å¯†é’¥**ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰
   ```
   SecretId: AKID_your_actual_secret_id_here
   SecretKey: ....... (32ä½å­—ç¬¦ä¸²)
   ```

### å¯†é’¥æ ¼å¼éªŒè¯

- âœ… SecretId åº”è¯¥ä»¥ `AKID` å¼€å¤´ï¼Œé•¿åº¦çº¦ 36 å­—ç¬¦
- âœ… SecretKey é•¿åº¦çº¦ 32 å­—ç¬¦
- âœ… å¯†é’¥çŠ¶æ€ä¸º"å¯ç”¨"

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šé…ç½® .env æ–‡ä»¶

ä½ çš„ `.env` æ–‡ä»¶å·²ç»å‡†å¤‡å¥½äº†ï¼Œç°åœ¨éœ€è¦å¡«å…¥å¯†é’¥ã€‚

### æ‰“å¼€ .env æ–‡ä»¶

```bash
# ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€
vim .env
# æˆ–
code .env
# æˆ–
nano .env
```

### æ‰¾åˆ°è…¾è®¯äº‘é…ç½®éƒ¨åˆ†ï¼ˆç¬¬ 65-80 è¡Œï¼‰

```bash
# ----------------------------------------
# è…¾è®¯äº‘ API é…ç½® (å›¾ç‰‡é£æ ¼åŒ–)
# ----------------------------------------
# è…¾è®¯äº‘ SecretId (è®¿é—®ç®¡ç† -> è®¿é—®å¯†é’¥è·å–)
TENCENT_CLOUD_SECRET_ID=your_secret_id_here

# è…¾è®¯äº‘ SecretKey
TENCENT_CLOUD_SECRET_KEY=your_secret_key_here

# è…¾è®¯äº‘åœ°åŸŸ: ap-guangzhou | ap-beijing | ap-shanghai
TENCENT_CLOUD_REGION=ap-guangzhou

# é£æ ¼åŒ–å¤„ç†è¶…æ—¶æ—¶é—´(ç§’)
STYLE_TRANSFER_TIMEOUT=60

# é£æ ¼åŒ–æœ€å¤§é‡è¯•æ¬¡æ•°
STYLE_TRANSFER_MAX_RETRIES=3
```

### æ›¿æ¢ä¸ºä½ çš„å¯†é’¥

å°†ä¸Šé¢çš„ `your_secret_id_here` å’Œ `your_secret_key_here` æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†é’¥ï¼š

```bash
TENCENT_CLOUD_SECRET_ID=AKID_your_actual_secret_id_here_your_actual_secret_id_here
TENCENT_CLOUD_SECRET_KEY=your_actual_secret_key_32_chars
TENCENT_CLOUD_REGION=ap-guangzhou
```

### ä¿å­˜æ–‡ä»¶

- Vim: æŒ‰ `ESC`ï¼Œè¾“å…¥ `:wq`ï¼Œå›è½¦
- VSCode: `Ctrl+S` (Windows/Linux) æˆ– `Cmd+S` (Mac)
- Nano: `Ctrl+O` ä¿å­˜ï¼Œ`Ctrl+X` é€€å‡º

---

## âœ… ç¬¬ä¸‰æ­¥ï¼šéªŒè¯é…ç½®

### 3.1 æ£€æŸ¥ .env æ–‡ä»¶

```bash
# æŸ¥çœ‹é…ç½®ï¼ˆä¸ä¼šæ˜¾ç¤ºå®Œæ•´å¯†é’¥ï¼Œå®‰å…¨ï¼‰
grep "TENCENT_CLOUD" .env
```

**é¢„æœŸè¾“å‡º**ï¼š
```
TENCENT_CLOUD_SECRET_ID=AKID_your_actual_secret_id_here...
TENCENT_CLOUD_SECRET_KEY=xxxxxxxx...
TENCENT_CLOUD_REGION=ap-guangzhou
```

### 3.2 ç¡®è®¤å¯†é’¥æ ¼å¼

- [ ] SecretId ä»¥ `AKID` å¼€å¤´
- [ ] å¯†é’¥ä¸­æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼
- [ ] æ²¡æœ‰å¼•å·ï¼ˆä¸éœ€è¦ç”¨å¼•å·åŒ…è£¹ï¼‰
- [ ] Region æ‹¼å†™æ­£ç¡®ï¼ˆap-guangzhouã€ap-beijing æˆ– ap-shanghaiï¼‰

---

## ğŸ–¼ï¸ ç¬¬å››æ­¥ï¼šå‡†å¤‡æµ‹è¯•å›¾ç‰‡

### 4.1 å‡†å¤‡ä¸€å¼ æµ‹è¯•å›¾ç‰‡

**è¦æ±‚**ï¼š
- æ ¼å¼ï¼šJPGã€PNG æˆ– WEBP
- å¤§å°ï¼š< 10 MBï¼ˆå»ºè®® 2-5 MBï¼‰
- åˆ†è¾¨ç‡ï¼šå»ºè®® 1024x1024 å·¦å³
- å†…å®¹ï¼šäººç‰©ç…§ç‰‡ï¼ˆåŠ¨æ¼«é£æ ¼æ•ˆæœæœ€ä½³ï¼‰

### 4.2 é‡å‘½åå¹¶æ”¾åˆ°æŒ‡å®šç›®å½•

```bash
# è¿›å…¥ example ç›®å½•
cd example/tencent_cloud

# å¤åˆ¶ä½ çš„å›¾ç‰‡å¹¶é‡å‘½å
cp /path/to/your/photo.jpg test_input.jpg

# æˆ–è€…ç›´æ¥ä¸‹è½½ä¸€å¼ æµ‹è¯•å›¾ç‰‡ï¼ˆç¤ºä¾‹ï¼‰
# curl -o test_input.jpg https://example.com/test-photo.jpg
```

### 4.3 éªŒè¯å›¾ç‰‡

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh test_input.jpg

# æŸ¥çœ‹å›¾ç‰‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
file test_input.jpg
```

**é¢„æœŸè¾“å‡º**ï¼š
```
-rw-r--r--  1 user  staff   2.3M Oct 25 12:00 test_input.jpg
```

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šè¿è¡ŒéªŒè¯æµ‹è¯•

### 5.1 å®‰è£…ä¾èµ–

```bash
# è¿›å…¥åç«¯ç›®å½•
cd ../../backend

# å®‰è£…è…¾è®¯äº‘ SDK
pip install tencentcloud-sdk-python-aiart

# æˆ–å®‰è£…å…¨éƒ¨ä¾èµ–
pip install -r requirements.txt
```

### 5.2 è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# è¿”å›åˆ° example ç›®å½•
cd ../example/tencent_cloud

# è¿è¡ŒéªŒè¯è„šæœ¬
python test_api.py
```

### 5.3 æŸ¥çœ‹æµ‹è¯•ç»“æœ

#### âœ… æˆåŠŸçš„è¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸš€ è…¾è®¯äº‘å›¾åƒé£æ ¼åŒ– API é…ç½®éªŒè¯å·¥å…·
============================================================

============================================================
ğŸ” æ­¥éª¤ 1: æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
============================================================
âœ… æ‰¾åˆ° .env æ–‡ä»¶: /path/to/.env
âœ… ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
   SecretId: AKID_your_actual_secret_id_here
   SecretKey: xxxxxxxxxx...xxxx
   Region: ap-guangzhou

============================================================
ğŸ“¦ æ­¥éª¤ 2: æ£€æŸ¥ä¾èµ–åŒ…
============================================================
âœ… tencentcloud-sdk-python-aiart å·²å®‰è£…

============================================================
ğŸ–¼ï¸  æ­¥éª¤ 3: æ£€æŸ¥æµ‹è¯•å›¾ç‰‡
============================================================
âœ… æ‰¾åˆ°æµ‹è¯•å›¾ç‰‡: test_input.jpg
   æ–‡ä»¶å¤§å°: 2.34 MB

============================================================
ğŸ¨ æ­¥éª¤ 4: æµ‹è¯• API è°ƒç”¨
============================================================

ğŸ”§ åˆå§‹åŒ–è…¾è®¯äº‘å®¢æˆ·ç«¯...
âœ… å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ

ğŸ¨ å¼€å§‹æµ‹è¯•å›¾ç‰‡é£æ ¼åŒ–...
   è¾“å…¥å›¾ç‰‡: test_input.jpg
   é£æ ¼ç±»å‹: anime (åŠ¨æ¼«é£æ ¼)
   è¾“å‡ºå›¾ç‰‡: test_output_anime.jpg

   â³ å¤„ç†ä¸­ï¼Œé¢„è®¡éœ€è¦ 10-30 ç§’...

å›¾ç‰‡å·²ä¿å­˜åˆ°: test_output_anime.jpg

============================================================
ğŸ‰ æµ‹è¯•æˆåŠŸï¼
============================================================
âœ… è¯·æ±‚ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
âœ… è¾“å‡ºæ–‡ä»¶: test_output_anime.jpg

============================================================
âœ… é…ç½®éªŒè¯å®Œæˆï¼
============================================================
```

#### âŒ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

**é”™è¯¯ 1ï¼šæ‰¾ä¸åˆ° .env æ–‡ä»¶**
```
âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° .env æ–‡ä»¶
```
**è§£å†³**ï¼šç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•æœ‰ `.env` æ–‡ä»¶

---

**é”™è¯¯ 2ï¼šSecretId æœªé…ç½®**
```
âŒ é”™è¯¯ï¼šTENCENT_CLOUD_SECRET_ID æœªé…ç½®
```
**è§£å†³**ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶ä¸­æ˜¯å¦æ­£ç¡®å¡«å†™äº† SecretId

---

**é”™è¯¯ 3ï¼šå¯†é’¥ä¸æ­£ç¡®**
```
âŒ æµ‹è¯•å¤±è´¥: [AuthFailure] authentication failed
```
**è§£å†³**ï¼š
1. æ£€æŸ¥å¯†é’¥æ˜¯å¦å¤åˆ¶å®Œæ•´
2. ç¡®è®¤å¯†é’¥çŠ¶æ€ä¸º"å¯ç”¨"
3. ç­‰å¾… 1-2 åˆ†é’Ÿåé‡è¯•

---

**é”™è¯¯ 4ï¼šä½™é¢ä¸è¶³**
```
âŒ æµ‹è¯•å¤±è´¥: [ResourceUsSuspended.InsufficientBalance]
```
**è§£å†³**ï¼š
1. æ£€æŸ¥å…è´¹é¢åº¦æ˜¯å¦ç”¨å®Œ
2. è®¿é—®è´¹ç”¨ä¸­å¿ƒå……å€¼

---

**é”™è¯¯ 5ï¼šå›¾ç‰‡æ ¼å¼é”™è¯¯**
```
âŒ æµ‹è¯•å¤±è´¥: [FailedOperation.ImageDecodeFailed]
```
**è§£å†³**ï¼š
1. ç¡®ä¿å›¾ç‰‡æ ¼å¼ä¸º JPGã€PNG æˆ– WEBP
2. å°è¯•ä½¿ç”¨æ›´å°çš„å›¾ç‰‡

---

## ğŸ¨ ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹ç”Ÿæˆç»“æœ

### 6.1 æ‰¾åˆ°è¾“å‡ºæ–‡ä»¶

```bash
# åœ¨ example/tencent_cloud ç›®å½•
ls -lh test_output_anime.jpg
```

### 6.2 æŸ¥çœ‹å›¾ç‰‡

- **Mac**: `open test_output_anime.jpg`
- **Linux**: `xdg-open test_output_anime.jpg`
- **Windows**: `start test_output_anime.jpg`

### 6.3 å°è¯•æ›´å¤šé£æ ¼

ç¼–è¾‘ `test_api.py`ï¼Œä¿®æ”¹é£æ ¼ç±»å‹ï¼š

```python
# ç¬¬ 138 è¡Œé™„è¿‘
result = client.transfer_style(
    image_path="test_input.jpg",
    style_type="cartoon_3d",  # æ”¹ä¸ºå…¶ä»–é£æ ¼
    output_path="test_output_cartoon.jpg"
)
```

**å¯ç”¨é£æ ¼**ï¼š
- `anime` - æ—¥ç³»åŠ¨æ¼«é£æ ¼
- `cartoon_3d` - 3Då¡é€šï¼ˆçš®å…‹æ–¯é£æ ¼ï¼‰
- `sketch` - é“…ç¬”ç´ æ
- `watercolor` - æ°´å½©ç”»
- `oil_painting` - æ²¹ç”»

---

## ğŸ“Š é…ç½®å®Œæˆç¡®è®¤

å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤åï¼Œè¯·ç¡®è®¤ï¼š

- [x] âœ… .env æ–‡ä»¶å·²é…ç½®è…¾è®¯äº‘å¯†é’¥
- [x] âœ… ä¾èµ–åŒ…å·²å®‰è£…
- [x] âœ… æµ‹è¯•å›¾ç‰‡å·²å‡†å¤‡
- [x] âœ… éªŒè¯è„šæœ¬è¿è¡ŒæˆåŠŸ
- [x] âœ… ç”Ÿæˆçš„å›¾ç‰‡æ•ˆæœæ»¡æ„

---

## ğŸ¯ ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**
   - [README.md](./README.md) - å®Œæ•´ä½¿ç”¨æŒ‡å—
   - [API_STYLE.md](../../docs/API_STYLE.md) - API è®¾è®¡æ–‡æ¡£

2. **å¼€å§‹é›†æˆåˆ°é¡¹ç›®**
   - å®ç°åç«¯ API
   - åˆ›å»ºå‰ç«¯ç•Œé¢
   - å‚è€ƒ README.md çš„"é›†æˆåˆ°é¡¹ç›®"ç« èŠ‚

3. **æ¢ç´¢æ›´å¤šåŠŸèƒ½**
   - æ‰¹é‡å¤„ç†å¤šå¼ å›¾ç‰‡
   - è°ƒæ•´é£æ ¼å¼ºåº¦å‚æ•°
   - é›†æˆåˆ° Celery å¼‚æ­¥ä»»åŠ¡

---

## ğŸ’¡ æç¤º

### å®‰å…¨å»ºè®®
- âš ï¸ ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
- âš ï¸ å®šæœŸæ›´æ¢ API å¯†é’¥ï¼ˆå»ºè®® 3-6 ä¸ªæœˆï¼‰
- âš ï¸ ä½¿ç”¨å­è´¦å·å¯†é’¥è€Œéä¸»è´¦å·

### æˆæœ¬æ§åˆ¶
- ğŸ’° å…è´¹é¢åº¦ï¼š100 æ¬¡/æœˆ
- ğŸ’° è¶…é‡è®¡è´¹ï¼šçº¦ 0.1 å…ƒ/æ¬¡
- ğŸ’° å»ºè®®è®¾ç½®è´¹ç”¨å‘Šè­¦

### æ€§èƒ½ä¼˜åŒ–
- âš¡ å›¾ç‰‡å‹ç¼©è‡³ 1024x1024 å¯åŠ å¿«å¤„ç†
- âš¡ ä½¿ç”¨ Celery å¼‚æ­¥å¤„ç†é¿å…é˜»å¡
- âš¡ ç›¸åŒå›¾ç‰‡+é£æ ¼å¯ç¼“å­˜ç»“æœ

---

**æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-25
**é€‚ç”¨äº**: é¦–æ¬¡é…ç½®è…¾è®¯äº‘å›¾åƒé£æ ¼åŒ– API

ç¥ä½ é…ç½®é¡ºåˆ©ï¼ğŸ‰
